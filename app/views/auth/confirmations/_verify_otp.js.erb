$("#login_content").html("<%= escape_javascript(render partial: Auth.configuration.auth_resources[resource.class.to_s.capitalize][:additional_login_param_verification_result_partial]) %>");
(function poll(counter){
   setTimeout(function(){
      $.ajax({ 
      	data: {"<%= resource.class.name.downcase.underscore.to_s %>" : {_id : "<%= resource.id.to_s %>"}, intent: "<%= intent %>"},
      	url: "<%= Auth.configuration.mount_path %>/<%= resource.class.name.downcase.pluralize.to_s %>/otp_verification_result",
      	error: function(){
      		
      	}, 
      	success: function(data){
      		
	        if(counter == null){
	        	counter = 0;
	        }
	        counter++;
	        	if(data["verified"] == true){
	        		$("#verify_otp_result").html("Your account was successfully verified. Sign In to continue.");
	        		//store.remove("intent");
	        		if(data["follow_url"]){
	        			window.location = data["follow_url"];
	        		}
	        	}
		        else{

		        if(counter < 10){
		        	poll(counter);
		   		}
		   		else{
		   			//do the failure function result.
		   			//store.remove("intent");
		   		}
	   		}
      	},
      	dataType: "json"
      });
  }, 3000);
})();

