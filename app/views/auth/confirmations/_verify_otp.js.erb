$("#login_content").html("<%= escape_javascript(render partial: Auth.configuration.auth_resources[resource.class.to_s.capitalize][:additional_login_param_verification_result_partial]) %>");
(function poll(counter){
   setTimeout(function(){
      $.ajax({ 
      	data: {resource_id : "<%= resource.id.to_s %>", post_verification_intent: store.get("intent")},
      	url: "/otp_verification_result",
      	error: function(){
      		//remove the intent classes.
      		store.remove("intent");
      	} 
      	success: function(data){
      		console.log("data returned is:");
      		console.log(data);
	        if(counter == null){
	        	counter = 0;
	        }
	        counter++;
	        	if(data["verified"] == true){
	        		$("#verify_otp_result").html("Your account was successfully verified. Sign In to continue.");
	        		store.remove("intent");
	        		if(data["follow_url"]){
	        			window.location = data["follow_url"];
	        		}
	        	}
		        else{

		        if(counter < 10){
		        	poll(counter);
		   		}
		   		else{
		   			//do the failure function result.
		   			store.remove("intent");
		   		}
	   		}
      	},
      	dataType: "json"
      });
  }, 3000);
})();
